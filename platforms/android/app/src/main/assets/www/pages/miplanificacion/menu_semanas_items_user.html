<template>
    <div class="page" id="mainOpenEjercicios">
        <div class="ap_fondo_2">
            <div class="row">
                <div class="col text-align-center" style="margin:40px 20px 0px 20px;">
                    <div class="card">
                        <div class="card-content card-content-padding">
                            <h1 id="txtTituloUser3" class="text-align-center h1" style="color:#383838;margin: 0px !important;">  </h1>
                        </div>
                    </div> 
                </div>
            </div>
        </div>

        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="f7-icons">arrow_left</i>
                    </a>
                </div>
                <div class="title center"> <a href="/" class="link"><img src="images/logos/logo-h.png" class="ap_logo-h"></a> </div>
            </div>
        </div>

        <div class="page-content" style="padding:0px;padding-top:100px;">
            <h2 id="txtTrimestre2" class="text-align-center" style="color:#fff;margin-bottom: 0px;"> </h2>
            <h3 id="txtTrimestre3" style="color:#fff;margin: 0px;padding-bottom: 25px;" data-popover=".popover-planificacion-titulo" class="text-align-center popover-open"> </h3>

            <div class="card accordion-list custom-accordion" style="margin-left: 15%; margin-right: 15%;">
                <div class="accordion-item">
                    <div class="accordion-item-toggle card-header">
                        <i class="icon icon-plus">+</i>
                        <i class="icon icon-minus">-</i>
                        <span style="text-align: center;width: 100%;"><h3 style="color:#383838;" tkey="t_structure">ESTRUCTURA</h3></span>
                    </div>
                    <div class="accordion-item-content card-content card-content-padding text-align-center">
                        <div class="block" style="padding:30px;">
                            <table>
                                <tr>
                                    <th width="50">15 min</th>
                                    <td style="text-align:left;"><i>Entrada en calor</i></td>
                                </tr>
                                <tr>
                                    <th>20 min</th>
                                    <td style="text-align:left;"><i>Tema principal</i></td>
                                </tr>
                                <tr>
                                    <th>15 min</th>
                                    <td style="text-align:left;"><i>Practica del TP</i></td>
                                </tr>
                                <tr>
                                    <th>10 min</th>
                                    <td style="text-align:left;"><i>Vuelta a la calma o ejercicio de distracción</i></td>
                                </tr>
                            </table>
                        </div>                               
                    </div>
                </div>
            </div>

            <div class="separacion"></div>

            <div id="divItemEntrenamientoUser"> </div>

            <div class="separacion"></div>

        </div>  
        
        <div class="popover popover-planificacion-titulo">
            <div class="popover-inner">
                <div class="card">
                    <div class="card-content">
                        <p id="txtCardTitleEjercicio" style="padding:10px;">Información.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</template>

<script>
    return { on: { pageInit: function(e, page) { loadMenu(page.route.params.idc, page.route.params.trimestre); } } }

    function recortaDatos(dato,longitud){
        var respuesta = dato;
        if(dato.length>longitud){
        respuesta = dato.substring(0,longitud-3)+"...";
        }
        return respuesta;
    }
    
    function loadMenu(ID, TRIMESTRES){        
        var API_USER = localStorage.getItem("LS_USER_API_KEY");
        var HTML  = "";

        localStorage.setItem("LS_PLANIFICACION_USER_ID", ID);

        $.ajax({
            type: "GET",
            headers: {"Authorization": API_USER},
            url: URL_SERVER+"planificacionItemsUser/"+ID+"/1",
            dataType: 'json',
            success: function (data){
                $.each(data.PLANIFICACIONITEM, function(index, item) {
                    var IDITEM = item.id;
                    HTML += '<div class="card">';
                    HTML += '<div class="card-content card-content-padding">';
                    HTML += '<b class="ap_card-title ap-accordion" onclick="ap_accordion(this);" style="text-transform:uppercase;">'+ item.tema +'</b>';
                    HTML += '<div class="ap-panel" id="liItemsDivUser'+IDITEM+'">';
                    
                        var HTML2 = '';
                        $.ajax({
                            type: "GET",
                            headers: {"Authorization": API_USER},
                            url: URL_SERVER+"planificacionItemsUser/"+IDITEM+"/3",
                            dataType: 'json',
                            success: function (data){
                                $.each(data.PLANIFICACIONITEM, function(index, item) {
                                    var IDITEM2 = item.id;
                                    HTML2 += '<hr>'; // '<h3 style="text-align:center;text-transform:uppercase;">'+ item.descripcion +'</h3>';
                                    HTML2 += '<a href="#" data-id="'+IDITEM2+'" id="btnEditMiCLoud" class="link" onclick="modeEditMiCloud(this, \'ITEMS\');"><i class="icon f7-icons" style="font-size: 20px;">compose_fill</i></a>';
                                    HTML2 += '<a href="#" data-id="'+IDITEM2+'" id="btnAddMiCLoud" class="link" onclick="addMiCloud(this, \'ITEMS\');"><i class="icon f7-icons" style="font-size: 20px;">add_round</i></a>';
                                    HTML2 += '<ul id="liItemliItemsDivOtrosDivUser'+IDITEM2+'">';

                                    var HTML3 = "";
                                    $.ajax({
                                        type: "GET",
                                        headers: {"Authorization": API_USER},
                                        url: URL_SERVER+"planificacionItemsUser/"+IDITEM2+"/3",
                                        dataType: 'json',
                                        success: function (data){
                                            $.each(data.PLANIFICACIONITEM, function(index, item) {
                                                var EYE = item.lotengo == 0 ? "" : '<i class="f7-icons" style="font-size: 20px;">eye</i>';
                                                // HTML3 += '<h3 style="text-align: center;"></h3>';
                                                HTML3 += "<li>" + EYE +" <a href=\"#\" class=\"item-link\" data-edit="+item.edit+" onclick=\"abrir_ejercicio_desde_planificacionUser('"+item.id+"');\">"+ item.item + "</a></li>";
                                            });

                                            $("#liItemliItemsDivOtrosDivUser"+IDITEM2).html(HTML3);
                                        }
                                    });

                                    HTML2 += '</ul>';
                                });
                                $("#liItemsDivUser"+IDITEM).html(HTML2);
                                $("#txtTituloUser3").html(item.titulo);
                            }
                        }); 

                    HTML += '</div>';
                    HTML += '</div>';
                    HTML += '</div>';
                    HTML += '<div class="separacion"></div>';
                });   
                
                $("#divItemEntrenamientoUser").html(HTML);
            }
        });   
    }
</script>